<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Inferno Snippet Mockup Template</title>
  <!-- Import Roboto -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic|Roboto+Mono:400,500|Material+Icons" rel="stylesheet">
  <!-- Import Inferno's Styles -->
  <link rel="stylesheet" href="https://studio304nextechar.freetls.fastly.net/infernoAR/_templates/css/inferno-base-styles.css">
  <link rel="stylesheet" href="https://studio304nextechar.freetls.fastly.net/infernoAR/_templates/css/inferno-extra-styles.css">
  <!--  Local/Client Color Overrides if they file exists -->
  <link rel="stylesheet" href="../inferno-client.css">
  <script>
    let landingPageEl = null
    window.isLocalTemplate = true
  </script>
  <!-- Import JQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <!--  Authenticate into the platform and set session values so you can leverage API calls in your snippets -->
  <script>
    function authenticate(project) {
      const _baseUrl = 'https://ingress.infernocore.jolokia.com/api/'
      // Auth w/ Inferno API
      const params = {
        email: project.username,
        password: project.password,
        grantType: 'password',
      }

      // Set header
      const headers = {'X-InfernoCore-Domain': project.domain}

      // perform synchronous ajax call so rest of code waits until you are authenticated
      $.ajax({
        url: _baseUrl + 'token',
        type: 'POST',
        async: false,
        accept: 'application/json',
        contentType: 'application/json',
        headers: headers,
        data: JSON.stringify(params),
        success: function (res) {
          sessionStorage.setItem('domain', project.domain)
          storeUser(JSON.parse(res))
        },
        error: function (err) {
          alert(JSON.stringify(err))
        },
        complete: function () {
          console.log('user was authenticated into ', project.domain)
        },
      })

    }

    function storeUser(data) {
      // console.log(data);
      sessionStorage.setItem('clientId', data.ClientId)
      sessionStorage.setItem('token', data.AccessToken)
      sessionStorage.setItem('refreshToken', data.RefreshToken)
    }

    function login() {
      window.addEventListener('load', (event) => {
        const projectEl = document.querySelector('#novoProject');
        const projectName = projectEl ? projectEl.getAttribute('name') : null;
        const currentProject = projects.filter(project => {
          return project.name === projectName;
        })[0];

        if (!currentProject) {
          alert('could not log into Inferno \n\r Check the project name in the login() function');
          return;
        }

        authenticate(currentProject);
      });
    }

  </script>
  <!-- store your credentials in a local file -->
  <!-- use to keep credentials out of files in case of committing to REPO or sharing template with someone else.-->
  <!-- projects = [{name: 'anything', username: 'email@address.com', password: '**********', domain: 'novologic.infernoar.com'}]-->
  <script onload="login()" onerror="console.error('/inferno.config.js', 'does not exist, can not log into inferno as test user')" src="/inferno.config.js"></script>

  <!-- Liquid Templating -->
  <script src="https://cdn.jsdelivr.net/npm/liquidjs/dist/liquid.min.js"></script>
  <!--  Load Liquid JSON From Local file -->
  <script>
    function loadJSON(file, callback) {

      const xobj = new XMLHttpRequest()
      xobj.overrideMimeType('application/json')
      xobj.open('GET', file, false) // Replace 'my_data' with the path to your file
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == '200') {
          // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
          callback(xobj.responseText)
        }
      }
      xobj.send(null)
    }

    // Insert your liquid data here. Remember to convert from JSON to JS Object (use https://json-to-js.com/ or similar)
    // Set data object to null to skip Liquid processing. You probably want to do this if you're not using liquid as the
    // processing can potentially interfere with scripts that run on page load.
    var data = {}
    loadJSON('../liquid.json', function (response) {
      // Parse JSON string into object
      const x = JSON.parse(response)
      data = x[0]
    })

  </script>

  <!-- Build out Local Menu on Left Navigation -->

  <style>
    #localTemplateMenu {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 1em;
    }

    #localTemplateMenu a {
      display: block;
      margin: .25em;
      background-color: var(--sidebar-bg-color);
      border: none;
      border-bottom: solid 1px var(--sidebar-highlight-text-color);
      color: var(--sidebar-text-color);
      cursor: pointer;
      width: 80%;
      padding: .25em 0;
    }

    #localTemplateMenu a:hover {
      filter: brightness(80%);
      text-decoration: none;
      transform: translateX(-.3em);
    }

    #localTemplateMenu a.activeMenu {
      background-color: var(--sidebar-highlight-bg-color);
      color: var(--sidebar-text-color);
    }

    .aside-collapsed * #localTemplateMenu {
      margin: 0;
      padding: 1em 0;
    }

    .aside-collapsed * #localTemplateMenu a {
      word-wrap: break-word;
      min-width: 100%;
      border-radius: 0;
      border-bottom: 1px solid var(--sidebar-text-color);
    }

    .aside-collapsed * #localTemplateMenu a:hover {
      transform: none;
    }

  </style>
  <script>
    function buildLocalMenu() {
      window.addEventListener('load', (event) => {
        const menu = document.getElementById('localTemplateMenu');
        window.localTemplateMenuItems.forEach(item => {
          const menuItem = document.createElement('a');
          menuItem.href = "../" + item.file;
          menuItem.innerHTML = item.name;
          menuItem.setAttribute('title', item.file + '\n\r' + item.snippetID);
          try {
            const currentSnippet = landingPageEl.querySelector('#' + item.snippetID.toString());
            if (currentSnippet) {
              menuItem.classList.toggle('activeMenu');
            }
          } catch (e) {
            // do nothing;
          }
          menu.appendChild(menuItem);
        })
      })
    }
  </script>
  <script onload="buildLocalMenu()" onerror="console.error('../menu.js', 'does not exist, run inferno build {project-name} to generate menu.js file')" src="../menu.js"></script>

</head>

<body>
<div style="display:none" id="novoProject" name="halldale" onload="login()"></div>
<app-root class="layout-fixed has-menu">
  <videos-layout>
    <div class="wrapper" layout="column">
      <app-header class="topnavbar-wrapper">
        <mat-toolbar class="mat-elevation-z3 navbar topnavbar mat-toolbar mat-primary mat-toolbar-single-row ng-star-inserted" color="primary">
          <div class="navbar-header"><a href="/">LOCAL</a></div>
          <div class="ellipsis ng-star-inserted" flex layout="row" layout-align="start center">
            <button class="menu-btn mat-icon-button ng-star-inserted" hide mat-icon-button show-gt-sm trigger-resize onclick="mtTriggerMenu()">
              <span class="mat-button-wrapper">
                  <mat-icon class="mat-icon material-icons mat-icon-no-color" role="img" aria-hidden="true">
                    menu
                  </mat-icon>
              </span>
            </button>
            <div _ngcontent-inv-c7 class="mat-title ellipsis m0" flex title="Page Title">Sample Page Title</div>
          </div>
        </mat-toolbar>
      </app-header>
      <!-- SIDEBAR -->
      <videos-sidebar class="aside">
        <div class="aside-inner">
          <nav class="sidebar" sidebar-anyclick-close>
            <div class="nav" id="localTemplateMenu"></div>
          </nav>

        </div>
      </videos-sidebar>
      <!-- ./ SIDEBAR -->
      <!-- LANDING -->
      <section class="IE-FlexAuto" flex>
        <div class="content-wrapper">
          <landing-page class="ng-star-inserted">
            <div id="landing">
              <!-- CREATE SHADOW DOM AND ATTACH STYLES -->
              <script>
                landingPageEl = document.querySelector('landing-page').attachShadow({mode: 'open'})
                const landing = landingPageEl.appendChild(document.getElementById('landing'))
                landingPageEl.appendChild(landing)
                const loginPageEl = landingPageEl
              </script>
              <style type="text/css">
                @import url("https://studio304nextechar.freetls.fastly.net/infernoAR/_templates/css/inferno-shadow-styles.css");
              </style>
              <!-- ********************* -->
              <!-- ********************* -->
              <!-- ********************* -->
              <!-- SNIPPET CONTENT START -->
              <inferno-snippet-content id="0998455f-14ec-47e2-953e-5d3ad9e3cea6">

                <category-page-links id="category-page-links" style="display:none">
                  <!--
                    these links will allow navigating ot booth pages without page refreshing
                    this will print all categories not just the booths, no way around that at the time of this writing
                    links generated using liquid get picked up by the Angular Routing mechanism
                    links generated by by JS do not and cause a page/app reload
                    even when navigating within the app using relative URLS
                    -->
                  {% for category in data.Categories %}
                  {% assign page = category.Id | downcase %}
                  {% assign snippet = category.LandingPageSnippetId | downcase %}
                  <a href="/videos/{{ page }}/landing/{{ snippet }}" id="link_{{ page }}" pageid="{{ page }}">{{ category.Name }}</a>
                  {% endfor %}
                </category-page-links>


                <!--  Load custom fonts -->
                <script type="text/javascript">
                  function loadFont(name, url) {
                    if (document.fonts.check('1em ' + name)) {
                      return;
                    }
                    const fontFace = new FontFace(name, 'url(' + url + ')');

                    fontFace.load().then(function (loadedFont) {
                      document.fonts.add(loadedFont);
                      console.log('Loaded custom font ', name);
                    }).catch(function (error) {
                      // error occurred
                      console.log('Error loading ', name);
                    });

                  }

                  loadFont('gothamMed', 'https://studio304nextechar.freetls.fastly.net/infernoAR/grundfos/assets/GothamHTF-Medium.otf');
                  loadFont('gothamBlack', 'https://studio304nextechar.freetls.fastly.net/infernoAR/grundfos/assets/GothamHTF-Black.otf');
                  loadFont('gothamBook', 'https://studio304nextechar.freetls.fastly.net/infernoAR/grundfos/assets/GothamHTF-Book.otf');

                </script>

                <style>
                  /* prevent entire screen from going black if you try to reference an image that does not exist*/
                  /* apparently some style or JS that is setting a style do that somewhere else in the inferno system*/
                  img::after {
                    content: none;
                  }

                  .content {
                    background-image: url('https://studio304nextechar.freetls.fastly.net/infernoAR/halldale/agenda/agenda-logo-bg.jpg');
                    background-attachment: fixed;
                    background-repeat: no-repeat;
                    background-size: cover;
                    background-position: right bottom;
                    min-height: calc(100vh - 114px);
                    margin: -20px;
                    z-index: 1;
                    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
                  }

                  h1 {
                    color: white;
                    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
                    margin-left: 2%;
                    font-size: 2em;
                    font-weight: bolder;
                  }

                  .top-banner {
                    padding: 10px 50px;
                    line-height: 60px;
                    color: var(--branding-primary);
                    font-size: 32px;
                    background-color: #ffffff;

                  }

                  .top-banner span {
                    color: var(--sidebar-bg-color);
                  }

                  .top-banner img {
                    position: absolute;
                    right: 0;
                    width: 250px;
                    margin: .25em 1em;
                  }

                  .grid {
                    display: flex;
                    flex-direction: row;
                    flex-wrap: wrap;
                    max-width: 80%;
                    padding: 10px;
                  }

                  .directory-grid {
                    padding-bottom: 40px;
                  }

                  .card {
                    position: relative;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    width: 300px;
                    background-color: white;
                    border-radius: 1em;
                    margin: 10px;
                    padding: 10px;
                    color: #000000;
                    cursor: pointer;
                  }

                  .card:hover {
                    transform: scale(1.05);
                    filter: brightness(80%);
                  }

                  .card a {
                    color: #000000;
                    text-decoration: none;
                  }

                  .hero {
                    display: block;
                    position: relative;
                    width: 100%;
                    padding: 0;
                  }

                  .hero img {
                    width: 100%;
                    margin: 0;
                  }

                  .diamond {
                    width: 380px;
                  }

                  .silver {
                    width: 300px;
                  }

                  .card img {
                    width: 100%;
                    max-height: 100%;
                  }


                  .level {
                    width: 115px;
                    text-transform: uppercase;
                    position: absolute;
                    transform: rotateZ(-45deg);
                    text-align: center;
                    top: 8%;
                    left: -8%;
                    clip-path: polygon(17% 0%, 77% 0%, 93% 100%, 0% 100%);
                    text-indent: -8%;
                  }

                  .diamond .level {
                    background-color: rgba(0, 0, 0, .6);
                    top: 6%;
                    left: -7%;
                    color: white;
                  }

                  .silver .level {
                    background-color: rgba(192, 192, 192, .6);
                    left: -8%;
                    top: 6%;
                  }


                  .bronze .level {
                    background-color: rgba(184, 72, 1, .6);
                  }

                  .booth-happenings {
                    position: relative;
                    font-size: 1.25em;
                    line-height: 1.75em;
                    text-align: center;
                    color: white;
                    background-color: var(--sidebar-bg-color);
                    border: none;
                    cursor: pointer;
                    padding: .25em 1em;
                    float: right;
                    margin: 1em;
                  }

                  .booth-happenings:hover {
                    transform: scale(1.05);
                    filter: brightness(120%);
                    color: white;
                    text-decoration: none;
                  }


                </style>

                <style>
                  @media only screen and (max-width: 1024px) {
                    .grid {
                      max-width: 100%;
                    }

                    .featured-grid {
                      display: block;
                      text-align: center;
                    }

                    .silver .level {
                      top: 9%;
                    }
                  }

                  @media only screen and (max-width: 375px) {
                    .grid {
                      display: block;
                      text-align: center;
                    }

                    .top-banner img {
                      display: none;
                    }

                    .diamond {
                      max-width: 340px;
                    }
                  }
                </style>

                <div class="content">

                  <div class="top-banner">
                    <span>Exhibit Hall</span>
                    <img src="https://studio304nextechar.freetls.fastly.net/infernoAR/halldale/lobby/global-atvs-logo.png">
                  </div>

                  <div class="hero">
                    <img src="https://studio304nextechar.freetls.fastly.net/infernoAR/halldale/expo/hero-banner-v1.gif">
                  </div>

                  <div class="button-banner">
                    <a class="booth-happenings" id="On_Booth_Happenings_Click" target="_blank" href="https://studio304nextechar.freetls.fastly.net/infernoAR/halldale/expo/WED_booth events GATS Thursday.pdf">
                      On Booth Happenings
                    </a>

                  </div>

                  <div class="featured">
                    <h1>Featured</h1>
                    <div class="grid featured-grid"></div>
                  </div>

                  <div class="directory" ">
                    <h1>Directory</h1>
                    <div class="grid directory-grid"></div>
                  </div>


                  <template>
                    <div class="card" id>
                      <div class="level"></div>
                      <img src>
                    </div>
                  </template>

                </div>

                <script>

                  function pageLink(id, name) {
                    const pages = landingPageEl.querySelector('#category-page-links');
                    const link = pages.querySelector('#link_' +id);
                    if (link) {
                      link.dispatchEvent(new MouseEvent('click'));
                    } else {
                      alert(`The booth for ${name} is not ready`);
                    }
                  }

                  function buildSponsors() {

                    const notAvailable = 'javascript:void(0),alert("Booth not yet Available");';

                    const baseUrl = 'https://studio304nextechar.freetls.fastly.net/infernoAR/halldale/expo/v2/';
                    let list = [
                      {
                        level: 'diamond',
                        name: '_CAE',
                        img: 'Large_White_CAE.png',
                        id: "2aa60d3b-a270-4d98-fbaf-08d87e80b21f"
                      },
                      {
                        level: 'silver',
                        name: 'AMST',
                        img: 'Medium_White-AMST.png',
                        id: "663c3e50-9ed9-4ce7-6527-08d87e83235d"
                      },
                      {
                        level: 'bronze',
                        name: 'Alsim',
                        img: 'Small_White_alsim.png',
                        id: "d3cbd043-cb32-48f6-6525-08d87e83235d"
                      },
                      {
                        level: 'bronze',
                        name: 'Aviation eLearning',
                        img: 'Small_White_AviationeLearning.png',
                        id: "d9e8576b-7c4d-4914-4fbd-08d87d490c28"
                      },
                      {
                        level: 'bronze',
                        name: 'Avion Group',
                        img: 'Small_White_avion.png',
                        id: '12da6057-7390-4806-c343-08d8744f050e'
                      },
                      {
                        level: 'bronze',
                        name: 'Bhirle',
                        img: 'Small_White_Bihrle.png',
                        id: 'b6706f0b-7eae-4e53-e4cf-08d87ea2e77a'
                      },
                      {
                        level: 'bronze',
                        name: 'Cole Engineering Services, Inc.',
                        img: 'Small_White_CESI_2.png',
                        id: '642bf2b2-6f08-41cc-acc4-08d87c9ee3ea'
                      },
                      {
                        level: 'bronze',
                        name: 'CPaT Global',
                        img: 'Small_White_CPaT.png',
                        id: '04934a6f-e1fe-41ec-0028-08d87b4df110'
                      },
                      {
                        level: 'bronze',
                        name: 'Drillster',
                        img: 'Small_White_Drillster.png',
                        id: '71fbade1-2902-47c4-4fc6-08d87d490c28'
                      },
                      {
                        level: 'bronze',
                        name: 'Entrol',
                        img: 'Small_White_entrol.png',
                        id: '922d379a-f43d-405e-3c76-08d87cc3b3e3'
                      },
                      {
                        level: 'bronze',
                        name: 'Flight Simulation Company',
                        img: 'Small_White_Flight.png',
                        id: '2d23ffb6-3657-4fde-0603-08d87a694829'
                      },
                      {
                        level: 'bronze',
                        name: 'JETPUBS',
                        img: 'Small_White_JETPUBS.png',
                        id: 'e475728c-7102-455f-cb8d-08d87d161b6f'
                      },
                      {
                        level: 'bronze',
                        name: 'MINT',
                        img: 'Small_White_MINT_1.png',
                        id: '607bbc29-6d9b-4b11-7e82-08d87eac1a55'
                      },
                      {
                        level: 'bronze',
                        name: 'Pace',
                        img: 'Small_White_PACE.png',
                        id: 'ed837287-0f07-4482-fbab-08d87e80b21f'
                      },
                      {
                        level: 'bronze',
                        name: 'ProSim Training Solutions',
                        img: 'Small_White_ProSim.png',
                        id: '2c1bdd7b-3cfe-46ab-8000-08d87b4f05c1'
                      },
                      {
                        level: 'bronze',
                        name: 'Simnest Aviation',
                        img: 'Small_White_SimnestAviation.png',
                        id: 'fcb730aa-ea8d-4b7d-255d-08d87a478093'
                      },
                      {
                        level: 'bronze',
                        name: 'SmartEye',
                        img: 'Small_White_SmartEye.png',
                        id: 'd1965ef6-06a7-4e2a-e4cb-08d87ea2e77a'
                      },
                      {
                        level: 'bronze',
                        name: 'Urbe Aero',
                        img: 'Small_White_UrbeAero.png',
                        id: '71fa3522-9449-4141-fbb0-08d87e80b21f'
                      },
                      {
                        level: 'bronze',
                        name: 'Wright Brothers',
                        img: 'Small_White_WrightBrothersFlight.png',
                        id: '29f17541-d6eb-4906-c337-08d8744f050e'
                      },
                    ];

                    list = list.sort(function (a, b) {
                      if (a.name.toLowerCase() > b.name.toLowerCase()) {
                        return 1;
                      }
                      if (a.name.toLowerCase() < b.name.toLowerCase()) {
                        return -1;
                      }
                      return 0;
                    });

                    // filter out users who have opted out of sharing their data
                    const featured = landingPageEl.querySelector('.featured-grid');
                    const directory = landingPageEl.querySelector('.directory-grid');
                    const template = landingPageEl.querySelector('template');

                    list.forEach(item => {
                      const clone = template.content.cloneNode(true);
                      const card = clone.querySelector('.card');
                      card.classList.add(item.level);

                      /**
                       * setup the virtual click linking so angular
                       * uses internal routing to navigate to the page
                        */
                      card.onclick = function() {
                        // id = the inferno category page id of the booth
                        console.log('click', item.id);
                        pageLink(item.id, item.name);
                      }

                      card.querySelector('img').src = baseUrl + item.img;
                      card.querySelector('.level').innerHTML = item.level;

                      if (item.level.toLowerCase().includes('bronze')) {
                        directory.appendChild(clone);
                      } else {
                        featured.appendChild(clone);
                      }
                    });

                  }

                  if (window.isLocalTemplate) {
                    window.addEventListener('load', (event) => {
                      buildSponsors();
                      console.log('Running Local Template', 'Page Loaded');
                    });
                  } else {
                    buildSponsors();
                  }

                </script>

                <!-- hack to get the main header text readable when --branding-primary = white or other really light color -->
                <script>
                  if (!window.whiteHack) {
                    console.log('loading color overrides for --branding-primary = white');
                    const css = `
                          jolo-search-box .search-box-container {display: none !important}
                          span.i, div.g, ly-icon.material-icons.ab, .cp, .mat-toolbar, .mat-toolbar button.menu-btn.mat-icon-button, .mat-toolbar .mat-title { color: #000 !important; }
                    `;
                    const head = document.head || document.getElementsByTagName('head')[0];
                    const style = document.createElement('style');
                    style.appendChild(document.createTextNode(css));
                    head.appendChild(style);
                    window.whiteHack = true;
                  }
                </script>


                <chatwee-initialize>
                  <!-- {%- assign userInfernoId = data.CurrentViewingUser.Id -%}
                  {%- assign userFirstName = data.CurrentViewingUser.FirstName -%}
                  {%- assign userLastName = data.CurrentViewingUser.LastName -%} -->

                  <!-- get duration till end of conference plus one day for buffer -->
                  <!-- this determines the length of time to set the chatwee cookie expiration too -->
                  {%- assign eventsByDate = data.Events | sort: "StartTime" -%}
                  {%- assign lastEvent = eventsByDate.last -%}

                  {%- assign eventStart = lastEvent.StartTime | date: "%s" | plus: 0 -%}
                  {%- assign eventEnd = eventStart | plus: lastEvent.VideoDuration -%}
                  {%- assign nowTimestamp = "now" | date: "%s" | plus: 0 -%}

                  <!-- difference in seconds -->
                  {%- assign diffSeconds = eventEnd | minus:nowTimestamp -%}
                  {%- assign secondsInADay = 5 | times: 24 | times: 60 | times: 60 -%}
                  {%- assign chatDuration = diffSeconds | plus: secondsInADay -%}

                  <div style="display:none;">
                    <p id="user-inferno-first-name">${firstName}</p>
                    <p id="user-inferno-last-name">${lastName}</p>
                  </div>

                  <script async>

                    var userInfernoId = window.sessionStorage.getItem("userId");
                    var firstName = window.isLocalTemplate ? 'TEST' : landingPageEl.getElementById("user-inferno-first-name").innerHTML;
                    var lastName = window.isLocalTemplate ? 'USER' : landingPageEl.getElementById("user-inferno-last-name").innerHTML;

                    var chatDuration = "{{ chatDuration }}";
                    var hasProfileImage = false;

                    // global chat manager
                    var chatManager = null;

                    var chatweeValues = {
                      userIdKey: "chatwee-user-id",
                      sessionCookieKey: "chatwee-SID-5f7ef4b1ebaa9f3cf83ed7fa",
                      chatId: "5f7ef4b1ebaa9f3cf83ed7fa",
                      clientApiKey: "a6feff42c070b4633a876aec",
                      isAdmin: 0,
                      ssoBaseUrl: "https://chatwee-api.com/v2/sso-user/"
                    }

                    var loadChatScript = () => {
                      // don't load script if already on page
                      let chatScript = document.getElementById("chat-script");
                      if (chatScript) return;

                      (function () {
                        var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
                        s1.id = "chat-script";
                        s1.async = true;
                        s1.src = 'https://static.chatwee-api.com/v2/script.js';
                        s1.charset = 'UTF-8';
                        s0.parentNode.insertBefore(s1, s0);
                      })();

                      return;
                    }

                    var loadChatStyles = () => {
                      return;  // no custom styling for this instance

                      // dont load styles if already on page
                      // let chatStyleSheet = document.getElementById("chat-replacement-styling");
                      // if (chatStyleSheet) return;
                      //
                      // (function () {
                      //   var link1 = document.createElement("link"), body = document.getElementsByTagName("body")[0];
                      //
                      //   link1.setAttribute("id", "chat-replacement-styling")
                      //   link1.setAttribute("rel", "stylesheet")
                      //   link1.setAttribute("type", "text/css")
                      //   link1.setAttribute("href", "https://studio304nextechar.freetls.fastly.net/infernoAR/arc2020/assets/chat-styling.css")
                      //   link1.setAttribute("media", "all")
                      //   body.parentNode.insertBefore(link1, body);
                      // })();

                      return;
                    }

                    var startChat = async () => {
                      if (!chatManager) {
                        chatManager = new ChatweeLib.ChatweeManager(chatweeValues.chatId);
                        // chatManager.Run();
                      }
                    }

                    var openChat = () => {
                      // close bubble
                      let bubbleChild = document.getElementsByClassName('chch-fixedChatweeWindowSwitch')[0];
                      let bubble = bubbleChild.parentNode;
                      bubble.style.display = "none";

                      // open chat
                      let chatChild = document.getElementsByClassName('chch-resizablePane')[0];
                      let chat = chatChild.parentNode;
                      chat.style.display = "block";
                      return;
                    }

                    // Chatwee UserId must be set as the Id for the button
                    var triggerConversation = e => {
                      let userId = e.target.id;
                      openChat();
                      chatManager.TriggerConversation(userId);
                    }

                    // helper functions
                    var getCookie = key => {
                      let cookieValue = "";

                      const cookieList = document.cookie;
                      if (cookieList) {
                        const cookie = cookieList
                          .split("; ")
                          .find(row => row.startsWith(key));

                        if (cookie) {
                          cookieValue = cookie.split("=")[1];
                        }

                      }
                      return cookieValue;
                    }

                    var setCookie = (key, value, age) => {
                      document.cookie = key + "=" + value + "; max-age=" + age + "; path=/";
                    }

                    var validateChatSessionId = sessionId => {
                      const url = chatweeValues.ssoBaseUrl
                        + "validate-session?"
                        + "chatId="
                        + chatweeValues.chatId
                        + "&clientKey="
                        + chatweeValues.clientApiKey
                        + "&sessionId="
                        + sessionId;

                      return fetch(url).then(res => res.json());
                    }

                    var loginChat = userId => {
                      const url = chatweeValues.ssoBaseUrl
                        + "login?"
                        + "chatId="
                        + chatweeValues.chatId
                        + "&clientKey="
                        + chatweeValues.clientApiKey
                        + "&userId="
                        + userId;

                      return fetch(url).then(res => res.json());
                    }

                    var registerChat = () => {
                      const name = firstName + " " + lastName;

                      // TO DO: get default chat icon
                      let avatarUrl = "https://studio304nextechar.freetls.fastly.net/infernoAR/halldale/chatwee/_avatar.jpg";

                      if (hasProfileImage) avatarUrl = "https://ingress.infernocore.jolokia.com/api/ProfileImage/" + userInfernoId + "/70" + "/70";

                      const url = chatweeValues.ssoBaseUrl
                        + "register?"
                        + "chatId="
                        + chatweeValues.chatId
                        + "&clientKey="
                        + chatweeValues.clientApiKey
                        + "&login="
                        + name
                        + "&isAdmin="
                        + chatweeValues.isAdmin
                        + "&avatar="
                        + avatarUrl;

                      return fetch(url).then(res => res.json());
                    }

                    // connect to Chatwee
                    var connectChat = async () => {

                      // see if session id locally
                      let sessionId = getCookie(chatweeValues.sessionCookieKey);

                      if (sessionId) {
                        // validate session id with chatwee
                        let valid
                        try {
                          valid = await validateChatSessionId(sessionId);
                        } catch (e) {
                          throw new Error(e);
                        }

                        // if true, do nothing
                        if (valid) return;

                      }

                      // if false, check if user id is present locally
                      const userId = getCookie(chatweeValues.userIdKey);

                      // if true, login and set session id locally
                      if (userId) {
                        let sessionId = ""
                        try {
                          sessionId = await loginChat(userId);
                        } catch (e) {
                          throw new Error(e);
                        }

                        setCookie(chatweeValues.sessionCookieKey, sessionId, chatDuration);
                      }
                      // if false, register and set user id and log in user
                      else {
                        let userId = ""
                        try {
                          userId = await registerChat();
                        } catch (e) {
                          throw new Error(e);
                        }

                        setCookie(chatweeValues.userIdKey, userId, chatDuration);

                        let sessionId = ""
                        try {
                          sessionId = await loginChat(userId);
                        } catch (e) {
                          throw new Error(e);
                        }

                        setCookie(chatweeValues.sessionCookieKey, sessionId, chatDuration);

                      }

                      return;
                    }

                    var getProfileImage = () => {
                      let url = "https://ingress.infernocore.jolokia.com/api/ProfileImage/" + userInfernoId + "/1" + "/1";
                      return fetch(url);
                    }

                    var waitForGlobal = async (key, callback1, callback2) => {
                      if (window[key]) {
                        await callback1();
                        await callback2();
                      } else {
                        setTimeout(function () {
                          waitForGlobal(key, callback1, callback2);
                        }, 100);
                      }
                    };

                    var setUpChat = async () => {
                      loadChatScript();
                      loadChatStyles();
                      const res = await getProfileImage();
                      if (res.status === 200) {
                        hasProfileImage = true;
                      }

                      waitForGlobal("ChatweeLib", connectChat, startChat);
                    }

                    setUpChat();

                  </script>

                </chatwee-initialize>


              </inferno-snippet-content>
              <!--  SNIPPET CONTENT END  -->
              <!-- ********************* -->
              <!-- ********************* -->
              <!-- ********************* -->
            </div>
          </landing-page>
        </div>
      </section>
      <!-- LANDING -->
      <!-- FOOTER -->
      <footer app-footer layout="row" layout-align="start center">
        Inferno Footer
      </footer>
      <!-- ./ FOOTER -->
    </div>
  </videos-layout>
</app-root>




<script>

  // LIQUID PROCESSING (Set the data variable above)
  function processLiquid() {
    return new Promise((resolve, reject) => {
      console.log('PROCESSING LIQUID')
      // We rip the entire content of the inferno-snippet-content element. InnerHTML returns certain characters such as < and > escaped.
      // This breaks comparison operators, so we need to convert them back before Liquid processing.
      const template = landingPageEl.querySelector('inferno-snippet-content').innerHTML.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&')
      // Select the element itself to replace the content
      const result = landingPageEl.querySelector('inferno-snippet-content')
      // Initialize the parsing engine
      const engine = new liquidjs.Liquid()
      // Parse and render
      engine.parseAndRender(template, {data}).then(html => result.innerHTML = html)
      resolve()
    })

  }

  // Set the menu initial state here: 'expanded', 'collapsed', or 'hidden'.
  function mtCollapseMenu() {
    const appRoot = document.querySelector('app-root')
    const sideBar = document.querySelector('videos-sidebar')
    window.sessionStorage.setItem('menuState', 'collapsed')
    appRoot.classList.add('aside-collapsed')
    appRoot.classList.remove('aside-hidden')
    sideBar.classList.remove('hidden')
  }

  function mtHideMenu() {
    const appRoot = document.querySelector('app-root')
    const sideBar = document.querySelector('videos-sidebar')
    window.sessionStorage.setItem('menuState', 'hidden')
    appRoot.classList.remove('aside-collapsed')
    appRoot.classList.add('aside-hidden')
    sideBar.classList.add('hidden')
  }

  function mtExpandMenu() {
    const appRoot = document.querySelector('app-root')
    const sideBar = document.querySelector('videos-sidebar')
    window.sessionStorage.setItem('menuState', 'expanded')
    appRoot.classList.remove('aside-hidden')
    appRoot.classList.remove('aside-collapsed')
    sideBar.classList.remove('hidden')
  }

  function mtTriggerMenu() {
    const appRoot = document.querySelector('app-root')
    const sideBar = document.querySelector('videos-sidebar')
    if (!appRoot.classList.contains('aside-collapsed') && !appRoot.classList.contains('aside-hidden')) {
      mtCollapseMenu()
    } else if (appRoot.classList.contains('aside-collapsed') && !appRoot.classList.contains('aside-hidden')) {
      mtHideMenu()
    } else if (appRoot.classList.contains('aside-hidden')) {
      mtExpandMenu()
    }
  }

  function mtInitMenu() {
    const appRoot = document.querySelector('app-root')
    const sideBar = document.querySelector('videos-sidebar')
    const state = sessionStorage.getItem('menuState')

    if (state === 'collapsed') {
      mtCollapseMenu()
    } else if (state === 'hidden') {
      mtHideMenu()
    } else if (state === 'expanded') {
      mtExpandMenu()
    }
  }

  function populateInfernoElements() {
    const qaDiv = landingPageEl.querySelector('#inferno-questions-basic')
    const videoDiv = landingPageEl.querySelector('#inferno-video-player')
    if (qaDiv) {
      $(qaDiv).append(`
      <questions _nghost-qch-c20="">
        <div class="ng-untouched ng-pristine ng-valid ng-star-inserted">
          <div class="inferno-input-group">
            <span class="inferno-input-group-addon">Ask A Question</span>
            <input class="inferno-form-control ng-untouched ng-pristine ng-valid" type="text">
            <span class="inferno-input-group-btn">
              <button class="inferno-btn" type="button">Submit</button>
            </span>
          </div>
        </div>
      </questions>
      `)
    }
    if (videoDiv) {
      $(videoDiv).append(`
        <iframe src="https://jolokia.inferno.jolokia.com/embed/ecd7f4ad-2c0a-4f3f-bfd6-37670cc2edbd"
          width="640"
          height="360"
          frameborder="0"
          allowfullscreen">
        </iframe>
        `)
    }
  }

  // Wait for liquid processing before handling the rest
  if (data) {
    processLiquid().then(mtInitMenu).then(populateInfernoElements)
  } else {
    mtInitMenu()
    populateInfernoElements()
  }

</script>



</body><!-- Menu Collapse Script -->
